% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/helpers.R
\name{get_derivatives}
\alias{get_derivatives}
\title{Fetch and Analyze Cryptocurrency Derivatives Market Data}
\usage{
get_derivatives(ticker = "BTCUSDT")
}
\arguments{
\item{ticker}{Character string specifying the trading pair. Default "BTCUSDT".
Format should follow Binance convention (e.g., "BTCUSDT", "ETHUSDT").}
}
\value{
A list object of class \code{derivatives_data} containing:

  \strong{Data Frame:}
  \itemize{
    \item \code{data}: Merged time series with columns:
      \itemize{
        \item \code{date}: Date of observation
        \item \code{open_interest}: Total number of outstanding contracts (in USD)
        \item \code{avg_funding_rate}: Mean funding rate for the day (as decimal)
        \item \code{max_funding_rate}: Maximum funding rate for the day
        \item \code{long}: Number of long positions
        \item \code{short}: Number of short positions
        \item \code{ls_ratio}: Long/short ratio (long/short)
      }
  }

  \strong{Percentiles:}
  \itemize{
    \item \code{oi_percentile}: Percentile rank of current open interest (0-1)
    \item \code{funding_percentile}: Percentile rank of current funding rate (0-1)
  }

  \strong{Signals:} List of derived trading signals
  \itemize{
    \item \code{crowded_long}: Logical vector - TRUE when OI >90th %ile AND funding >90th %ile
    \item \code{crowded_short}: Logical vector - TRUE when OI <10th %ile AND funding <10th %ile
    \item \code{oi_momentum}: 7-day percentage change in open interest
    \item \code{funding_regime}: Categorical regime based on funding rate:
      \itemize{
        \item \strong{Extreme Long}: Funding > 0.05% (annualized >18%)
        \item \strong{Bullish}: Funding 0.01% to 0.05%
        \item \strong{Neutral}: Funding 0.00% to 0.01%
        \item \strong{Bearish}: Funding -0.01% to 0.00%
        \item \strong{Extreme Short}: Funding < -0.01%
      }
  }
}
\description{
Retrieves and analyzes key derivatives market metrics from Binance, including
open interest, funding rates, and long/short ratios. These indicators provide
critical insights into market positioning, leverage dynamics, and potential
reversal points in the perpetual futures market.
}
\details{
The \code{get_derivatives()} function retrieves and analyzes three core derivatives
market metrics from Binance, providing critical insights into market positioning,
leverage dynamics, and potential reversal points.

\strong{Open Interest}

Open interest represents the total number of outstanding derivative contracts
that have not been settled. It measures the flow of money into the derivatives
market and provides context on trend strength and potential exhaustion:
\itemize{
  \item \strong{Rising OI + Rising Price:} New long money entering (trend confirmation)
  \item \strong{Rising OI + Falling Price:} New short money entering (distribution/short buildup)
  \item \strong{Falling OI + Any Price:} Position unwinding (trend exhaustion)
  \item \strong{OI > 90th percentile:} Market may be overextended
}

\strong{Funding Rates}

Perpetual swaps use funding rates to keep contract prices anchored to spot prices.
These periodic payments (every 8 hours on Binance) reveal the dominant market
sentiment and cost of maintaining leveraged positions:
\itemize{
  \item \strong{Positive funding:} Longs pay shorts (bullish sentiment)
  \item \strong{Negative funding:} Shorts pay longs (bearish sentiment)
  \item \strong{Extreme positive (> 0.05\%):} Market overly levered long, liquidation cascade risk
  \item \strong{Extreme negative (< -0.01\%):} Excessive short positioning, short squeeze risk
}

The function calculates daily average and maximum funding rates, then classifies
the market regime based on the magnitude of the average rate.

\strong{Long/Short Ratio}

The ratio of long to short positions provides direct insight into market
positioning and potential contrarian opportunities:
\itemize{
  \item \strong{High ratio (> 1.2):} More longs than shorts (bullish positioning)
  \item \strong{Low ratio (< 0.8):} More shorts than longs (bearish positioning)
  \item \strong{Extreme values:} Often precede reversals (contrarian signals)
}

\strong{Crowded Trade Detection}

The function combines open interest and funding rate percentiles to identify
potentially dangerous crowded positioning:
\itemize{
  \item \strong{Crowded Long:} OI > 90th percentile AND funding > 90th percentile
  \itemize{
    \item Market is excessively long with high leverage
    \item Vulnerable to long liquidations on any downside move
    \item Often precedes sharp reversals
  }
  \item \strong{Crowded Short:} OI < 10th percentile AND funding < 10th percentile
  \itemize{
    \item Market is excessively short with negative funding
    \item Shorts paying to maintain positions
    \item Primed for short squeeze
  }
}

\strong{Interpretation Guidelines}

When using these signals in your analysis:
\itemize{
  \item Use extreme funding rates as mean reversion signals
  \item Confirm trends with rising open interest
  \item Treat crowded positioning as warning signs, not immediate triggers
  \item Combine with on-chain and macro indicators for higher conviction
  \item Consider that different assets may have different "normal" ranges
}
}
\note{
\itemize{
  \item Percentiles are calculated over the entire available history for each metric
  \item First 7 days will have NA values for open interest momentum
  \item Funding rates are aggregated to daily averages from 8-hour snapshots
  \item Different exchanges may have different funding rate mechanisms
  \item No API key is required for Binance public data
}
}
\section{Trading Applications}{

\itemize{
  \item \strong{Mean Reversion}: Extreme funding rates (>0.05% or <-0.01%) often revert
  \item \strong{Trend Confirmation}: Rising OI confirms trend strength
  \item \strong{Reversal Detection}: Crowded long/short signals potential turning points
  \item \strong{Risk Management}: High OI + extreme funding suggests reducing leverage
}
}

\examples{
\dontrun{
# Get derivatives data for Bitcoin
btc_derivatives <- get_derivatives("BTCUSDT")

# View latest signals
latest_idx <- length(btc_derivatives$signals$funding_regime)
cat("Current funding regime:", btc_derivatives$signals$funding_regime[latest_idx], "\n")
cat("OI Percentile:", round(btc_derivatives$oi_percentile[latest_idx] * 100, 1), "\%\n")

# Check for crowded trades
if (tail(btc_derivatives$signals$crowded_long, 1)) {
  cat("⚠️  Warning: Crowded long positioning detected!\n")
}

# Plot open interest with percentile bands
library(ggplot2)
btc_derivatives$data \%>\%
  tail(90) \%>\%
  ggplot(aes(x = date, y = open_interest)) +
  geom_line() +
  geom_hline(yintercept = quantile(btc_derivatives$data$open_interest, 0.9, na.rm = TRUE),
             linetype = "dashed", color = "red") +
  geom_hline(yintercept = quantile(btc_derivatives$data$open_interest, 0.1, na.rm = TRUE),
             linetype = "dashed", color = "green") +
  labs(title = "Open Interest with 10th/90th Percentile Bands")

# Get Ethereum derivatives
eth_derivatives <- get_derivatives("ETHUSDT")

# Compare funding rates across assets
funding_comparison <- data.frame(
  date = btc_derivatives$data$date,
  BTC = btc_derivatives$data$avg_funding_rate * 100,
  ETH = eth_derivatives$data$avg_funding_rate * 100
)
}

}
\references{
\itemize{
  \item Binance Exchange (2024). "Perpetual Futures Guide"
  \item Hou, A. (2021). "The Informational Role of Bitcoin Futures Market"
  \item Zhang, S. (2022). "Funding Rates as a Sentiment Indicator in Crypto Markets"
}
}
\seealso{
\itemize{
  \item \code{\link{crypto_predictive_framework}} for integrating with broader framework
  \item Binance Futures API: \url{https://binance-docs.github.io/apidocs/futures/en/}
  \item \code{cryptoQuotes::get_openinterest} for underlying function details
}
}
\author{
Filippo Franchini
}
